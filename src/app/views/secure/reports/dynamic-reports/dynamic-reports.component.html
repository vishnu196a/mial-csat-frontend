<form [formGroup]="dynamicReportForm" (submit)="onFormSubmit()" autocomplete="off">
  <div class="card">
    <div class="card-header">
      <div class="row">
        <div class="col order-1 order-sm-0"></div>
        <div class="col-12 col-sm-auto order-0 order-sm-1">
          <h2 class="text-center">Dynamic Reports</h2>
        </div>
        <div class="col order-2">
          <div class="d-flex justify-content-end">
            <button
              class="btn btn-info mr-2"
              type="button"
              [disabled]="dynamicReportForm.invalid"
              (click)="onSaveAsTemplate()"
            >
              Save As Templates <span class="fa fa-save"></span>
            </button>
            <app-loading-button
              [disabled]="dynamicReportForm.invalid || toDateValidator"
              [buttonText]="'Download Report'"
              [title]="'Click to download report'"
              [isLoading]="isLoading"
              [loadingText]="'Downloading...'"
              [hideTextOnSM]="true"
              [buttonIconClass]="'fas fa-download'"
            ></app-loading-button>
          </div>
        </div>
      </div>
    </div>
    <div class="card-body">
      <div class="row m-0 mt-2">
        <div class="col-12 col-md-6 m-0">
          <div class="row d-flex align-items-center">
            <div class="col-4">
              <label for="name"> Report Name <span class="text-danger">*</span></label>
            </div>
            <div class="col-8">
              <input
                id="text"
                type="text"
                placeholder="Enter report name"
                class="form-control"
                formControlName="name"
              />
              <div *ngIf="formControls.name.touched && formControls.name.invalid">
                <small class="text-danger" *ngIf="formControls.name.errors?.required"
                  >Report name is required</small
                >
              </div>
            </div>
          </div>
          <div class="row mt-2 d-flex align-items-center">
            <div class="col-4">
              <label for="name"> Select Columns <span class="text-danger">*</span> </label>
            </div>
            <div class="col-8">
              <ng-multiselect-dropdown
                name="city"
                [placeholder]="'Select Columns'"
                [data]="columns"
                formControlName="columns"
                [settings]="dropdownSettings"
                textField="text"
              >
              </ng-multiselect-dropdown>

              <div *ngIf="formControls.columns.touched && formControls.columns.invalid">
                <small class="text-danger" *ngIf="formControls.columns.errors?.required"
                  >Select atleast one column</small
                >
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-6 m-0">
          <div class="col-12 d-flex justify-content-start p-0">
            <button class="btn btn-primary" type="button" (click)="openModal()">
              <span class="fa fa-search"></span> Select Template
            </button>
          </div>

          <div class="row mt-2 d-flex align-items-center">
            <div class="col-4">
              <label for="name"> From Date </label>
            </div>
            <div class="col-8">
              <input
                id="date-input"
                type="datetime-local"
                placeholder="From Date"
                class="form-control"
                formControlName="fromDate"
                [max]="maxDate"
                (change)="handleFilter()"
              />
            </div>
          </div>
          <div class="row mt-2 d-flex align-items-center">
            <div class="col-4">
              <label for="name"> To Date </label>
            </div>
            <div class="col-8">
              <input
                id="date-input"
                type="datetime-local"
                placeholder="From Date"
                class="form-control"
                formControlName="toDate"
                [max]="maxDate"
                (change)="handleFilter()"
              />
              <div *ngIf="toDateValidator">
                <small class="text-danger">To date should be greater than from date</small>
              </div>
            </div>
          </div>
          <div class="row mt-2 d-flex align-items-center">
            <div class="col-4">
              <label for="name"> Category </label>
            </div>
            <div class="col-8">
              <ng-select
                [items]="categories"
                [clearable]="true"
                [searchable]="true"
                bindValue="id"
                bindLabel="name"
                (change)="getSubCategoriesNamesIds()"
                placeholder="Select Category"
                formControlName="category"
                notFoundText="No categories found"
              ></ng-select>
            </div>
          </div>
          <div class="row mt-2 d-flex align-items-center">
            <div class="col-4">
              <label for="name"> Sub category </label>
            </div>
            <div class="col-8">
              <ng-select
                [items]="subCategories"
                [clearable]="true"
                [searchable]="true"
                bindValue="id"
                bindLabel="name"
                placeholder="Select Sub category"
                formControlName="subCategory"
                notFoundText="No sub categories found"
              >
              </ng-select>
            </div>
          </div>
          <div class="row mt-2 d-flex align-items-center">
            <div class="col-4">
              <label for="name"> Agent </label>
            </div>
            <div class="col-8">
              <ng-select
                [items]="agents"
                [clearable]="true"
                [searchable]="true"
                bindValue="id"
                bindLabel="name"
                formControlName="agent"
                placeholder="Select call status"
                notFoundText="No status found"
              >
              </ng-select>
            </div>
          </div>
          <div class="row mt-2 d-flex align-items-center">
            <div class="col-4">
              <label for="name"> Call source </label>
            </div>
            <div class="col-8">
              <ng-select
                [items]="modeOfCall"
                [clearable]="true"
                [searchable]="true"
                formControlName="callSource"
                placeholder="Select source"
                notFoundText="No source found"
              >
              </ng-select>
            </div>
          </div>
          <div class="row mt-2 d-flex align-items-center">
            <div class="col-4">
              <label for="name"> Status </label>
            </div>
            <div class="col-8">
              <ng-select
                [items]="callStatus"
                [clearable]="true"
                [searchable]="true"
                bindValue="id"
                bindLabel="name"
                formControlName="status"
                placeholder="Select call status"
                notFoundText="No status found"
              >
              </ng-select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
